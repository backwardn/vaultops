hosts:
  - "http://10.100.21.161:8200"
  - "http://10.100.21.162:8200"
  - "http://10.100.21.163:8200"
# vault mounts
mounts:
  - path: "k8s-ca"
    type: "pki"
    max-lease-ttl: "876000h"
# vault backends
backends:
  - name: "k8s-ca"
    roles:
      - name: "api-server"
        allowed-domains: "api-server,kubernetes,kubernetes.default"
        allow-bare-domains: true
        allow-any-name: true
        organization: "system:control-plane"
      - name: "kube-controller-manager"
        allow-bare-domains: true
        allow-any-name: true
        enforce-hostnames: false
        organization: "system:control-plane"
      - name: "kube-scheduler"
        allow-bare-domains: true
        allow-any-name: true
        enforce-hostnames: false
        organization: "system:control-plane"
      - name: "kube-proxy"
        allow-bare-domains: true
        allow-any-name: true
        enforce-hostnames: false
        organization: "system:control-plane"
      - name: "kubelet"
        allowed-domains: "kubelet"
        allow-bare-domains: true
        allow-any-name: true
        enforce-hostnames: false
        organization: "system:nodes"
      - name: "kubectl"
        allowed-domains: "kubectl"
        allow-bare-domains: true
        allow-any-name: true
        enforce-hostnames: false
        organization: "system:masters"
      - name: "auth"
        allowed-domains: "auth"
        allow-bare-domains: true
        allow-any-name: true
        enforce-hostnames: true
    certificates:
      - name: "root-ca"
        root: true
        common-name: "k8s-ca"
        ttl: "876000h"
        type: "internal"
      - name: "k8s-ca"
        common-name: "api-server"
        ttl: "875000h"
        ip-sans: "10.101.0.1,127.0.0.1,10.100.42.141"
        alt-names: "kubernetes.default.svc.cluster.local"
        role: "api-server"
        store: true
# vault policies
policies:
  - name: "k8s-ca"
    rules: |
      path "secret/k8s-ca/*" {
         policy = "write"
      }
      path "k8s-ca/roles/*" {
         policy = "write"
      }
      path "k8s-ca/issue/*" {
        policy = "write"
      }
