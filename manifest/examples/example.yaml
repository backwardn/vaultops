hosts:
  # vault hosts to initialize
  init:
    - "http://10.100.21.161:8200"
  # vault hosts to unseal
  unseal:
    - "http://10.100.21.161:8200"
    - "http://10.100.21.162:8200"
    - "http://10.100.21.163:8200"
# vault mounts
mounts:
  - path: "k8s-ca"
    type: "pki"
    max_lease_ttl: "876000h"
# vault backends
backends:
  - name: "k8s-ca"
    roles:
      - name: "api-server"
        allowed_domains: "api-server,kubernetes,kubernetes.default"
        allow_bare_domains: true
        allow_any_name: true
        organization: "system:control-plane"
      - name: "kube-controller-manager"
        allow_bare_domains: true
        allow_any_name: true
        enforce_hostnames: false
        organization: "system:control-plane"
      - name: "kube-scheduler"
        allow_bare_domains: true
        allow_any_name: true
        enforce_hostnames: false
        organization: "system:control-plane"
      - name: "kube-proxy"
        allow_bare_domains: true
        allow_any_name: true
        enforce_hostnames: false
        organization: "system:control-plane"
      - name: "kubelet"
        allowed_domains: "kubelet"
        allow_bare_domains: true
        allow_any_name: true
        enforce_hostnames: false
        organization: "system:nodes"
      - name: "kubectl"
        allowed_domains: "kubectl"
        allow_bare_domains: true
        allow_any_name: true
        enforce_hostnames: false
        organization: "system:masters"
      - name: "auth"
        allowed_domains: "auth"
        allow_bare_domains: true
        allow_any_name: true
        enforce_hostnames: true
    certificates:
      - name: "root-ca"
        action: "generate"
        type: "internal"
        kind: "root"
        common_name: "k8s-ca"
        ttl: "876000h"
      - name: "k8s-ca"
        action: "issue"
        common_name: "api-server"
        ttl: "875000h"
        ip_sans: "10.101.0.1,127.0.0.1,10.100.42.141"
        alt_names: "kubernetes.default.svc.cluster.local"
        role: "api-server"
# vault policies
policies:
  - name: "k8s-ca"
    rules: |
      path "secret/k8s-ca/*" {
         policy = "write"
      }
      path "k8s-ca/roles/*" {
         policy = "write"
      }
      path "k8s-ca/issue/*" {
        policy = "write"
      }
